# Маржинальная торговля KuCoin

Набор скриптов для автоматизированной маржинальной торговли на бирже KuCoin.

## Файлы

### 1. `kucoin.py` - Основной скрипт для открытия маржинальных позиций
Выполняет маржинальную продажу (шорт) указанного актива.

**Функции:**
- Получение текущих цен и баланса
- Расчет размера позиции на основе доступных средств
- Размещение маржинального ордера на продажу с автозаймом
- Отображение статуса маржинального аккаунта

### 2. `kucoin_close_position.py` - Закрытие маржинальных позиций
Закрывает открытые шорт-позиции путем покупки актива для погашения долга.

**Функции:**
- Анализ открытых позиций и долгов
- Расчет необходимого количества для закрытия позиции
- Размещение ордера на покупку для закрытия шорта
- Автоматическое погашение оставшегося долга

### 3. `kucoin_monitor.py` - Мониторинг маржинальных позиций
Отслеживает состояние маржинального аккаунта и уровни риска.

**Функции:**
- Отображение детальной информации о позициях
- Расчет уровня маржи и коэффициента долга
- Предупреждения о рисках ликвидации
- Приблизительный расчет P&L
- Непрерывный мониторинг с настраиваемым интервалом

## Настройка

### 1. Переменные окружения
Создайте файл `.env` в корневой директории проекта:

```env
KUCOIN_KEY=your_api_key
KUCOIN_SECRET=your_api_secret
KUCOIN_PASSWORD=your_api_passphrase
```

### 2. Настройка API ключей KuCoin
1. Войдите в аккаунт KuCoin
2. Перейдите в API Management
3. Создайте новый API ключ с разрешениями:
   - General (чтение)
   - Spot Trading (торговля)
   - Margin Trading (маржинальная торговля)
4. Скопируйте API Key, Secret и Passphrase в файл `.env`

### 3. Активация маржинальной торговли
Убедитесь, что в вашем аккаунте KuCoin активирована маржинальная торговля и есть средства в Cross Margin аккаунте.

## Использование

### Открытие шорт-позиции
```bash
python src/kucoin.py
```

Скрипт:
1. Покажет текущий статус аккаунта
2. Рассчитает размер позиции
3. Запросит подтверждение
4. Выполнит маржинальную продажу

### Закрытие позиции
```bash
python src/kucoin_close_position.py
```

Скрипт:
1. Проанализирует открытые позиции
2. Рассчитает стоимость закрытия
3. Запросит подтверждение
4. Закроет позицию и погасит долг

### Мониторинг позиций
```bash
python src/kucoin_monitor.py
```

Скрипт предоставит:
- Текущие цены и спреды
- Уровень маржи и риски
- Детальную информацию о позициях
- Возможность непрерывного мониторинга

## Настройки

### В файле `kucoin.py`:
- `symbol` - торговая пара (по умолчанию 'TON-USDT')
- `deposit_limit` - максимальная сумма для торговли в USDT

### Уровни риска (в мониторинге):
- **< 1.5** - Критический риск ликвидации
- **1.5-2.0** - Высокий риск
- **2.0-3.0** - Средний риск
- **> 3.0** - Безопасный уровень

## ⚠️ Важные предупреждения

1. **Риски маржинальной торговли:**
   - Возможны значительные потери, превышающие первоначальный депозит
   - Принудительная ликвидация при низком уровне маржи
   - Проценты на заемные средства

2. **Тестирование:**
   - Начните с небольших сумм
   - Протестируйте все функции перед использованием больших сумм

3. **Мониторинг:**
   - Регулярно отслеживайте уровень маржи
   - Будьте готовы к быстрому закрытию позиций при неблагоприятном движении цены

4. **API лимиты:**
   - Соблюдайте лимиты запросов KuCoin API
   - Не запускайте несколько скриптов одновременно

## Примеры использования

### Быстрая проверка статуса
```bash
python src/kucoin_monitor.py
# Выберите N для одноразового просмотра
```

### Открытие шорт-позиции на $10
Измените `deposit_limit = 10` в `kucoin.py`, затем:
```bash
python src/kucoin.py
```

### Непрерывный мониторинг каждые 60 секунд
```bash
python src/kucoin_monitor.py
# Выберите y для непрерывного мониторинга
# Введите 60 для интервала в секундах
```

## Поддержка

При возникновении проблем:
1. Проверьте правильность API ключей
2. Убедитесь в наличии средств в Cross Margin аккаунте
3. Проверьте статус маржинальной торговли в вашем аккаунте KuCoin
4. Изучите логи ошибок для диагностики проблем 